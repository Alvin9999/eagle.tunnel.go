# ET 配置

虽然不同的ET实现版本支持的特性不尽相同，但它们的配置文件是相互兼容的，少量不支持的参数会不生效。你可以在不同版本间使用同一个配置文件，使它们可以很好地协同工作，例如使用ET Go作为服务端时，你既可以使用ET Go，也可以使用ET D或者ET DNC来作为客户端。

## 主配置文件

所谓主配置文件就是启动ET需要给出的配置文件，如基本使用教程中的`client.conf`或`server.conf`。这个配置文件可以根据你喜欢位于任何位置，叫做任何名字。只要它遵循本文所述参数规则，你就可以用`et <配置文件>`这个格式的命令启动ET。

这个文件遵循以下格式：

> \# 注释部分  
> 参数1=参数1的值  
> 参数2=参数2的值

每行一对键值对。\#表示注释，符号`#`以及其所在行接下来的内容都将被忽略

## 配置参数

这一小节所说的参数，指的是主配置文件中所使用的参数。ET目前拥有的参数，以及其解释会被放在下表：

参数名|值类型|示例|默认值|解释
---|---|---|---|---
relayer|IP地址:端口号|8.8.8.8:8080|空|上级relayer（服务端）的监听地址。对于客户端来讲它是必填项。当你只填写了IP地址（如8.8.8.8）它会被自动添上默认端口号（8080）
listen|IP地址：端口号|127.0.0.1:8080|0.0.0.0:8080|本地relayer（客户端）的监听地址。当你只填写了IP地址（如8.8.8.8）它会被自动添上默认端口号（8080）。当它的值为0.0.0.0::8080时，代表程序会监听本地所有IP地址的8080端口
http|on/off|on|off|HTTP代理协议的开关。当值为on时，程序会接收HTTP代理协议的流量。这个参数通常被用于客户端中
socks|on/off|on|off|SOCKS协议的开关。当值为on时，程序会接收SOCKS协议的流量。这个参数通常被用于客户端中
et|on/off|on|off|ET协议的开关。当值为on时，程序会接收ET协议的流量。这个参数通常被用于服务端中
user|用户名:密码|username:password|空|客户端使用的登录账户。当它为空时，表示关闭用户检查（这需要服务端同时关闭用户检查）。
user-check|on/off|on|off|服务端的用户检查开关，当它为on时，用户检查功能开启。所有被授权的用户应该被写在用户列表中。用户列表的位置和规则会被列于下文。
proxy-status|enable/smart|smart|enable|代理服务的模式状态，这个参数只对客户端生效。当为enable时，为全局代理，当为smart时，为只能代理。这两种模式的区别会在下文进行详细解释。
config-dir|文件路径名|/etc/eagle-tunnel.d|/etc/eagle-tunnel.d|次要配置文件所在目录。次要配置文件包括用户列表、需要智能DNS解析的域名列表等

## 用户列表

用户列表是一个文本文件，它的位置为`${config-dir}/users.list`，默认情况下，这个位置为主配置文件同目录下的`users.list`。当这个文件不存在，你需要自行创建。

用户列表的格式如下所示：

> username1:password1:speedlimit4user1  
> 用户名2:密码2:用户2的速度限制  
> username3:password3:speedlimit4user3

每行代表一个用户，由三个参数组成——[用户名]:[密码]:[限速]。注意它们之间的`:`是一个半角符号，而不是全角的`：`。前两个参数（用户名和密码）是必须的，而第三个参数（限速）是可选的，当只有两个参数时——[用户名]:[密码]——代表该用户不限速。

## 代理模式

ET使用`proxy-status`参数来控制其代理模式。当其值为`enable`时，ET表现为普通的全局代理软件，所有DNS解析和流量转发都通过服务端进行。当其值为`smart`时，ET会有额外的智能分流特性，所谓智能分流分为两个部分——DNS智能解析和流量智能转发。

### DNS智能解析

当ET进行DNS解析时，首先会判断其被解析的域名是否处于`DNS智能解析白名单`中。

这个白名单的位置是`${config-dir}/whitelist_domain.txt`，默认情况下这个位置是主配置文件同目录的`whitelist_domain.txt`。它来自[SmartDNSDomainList](https://github.com/eaglexiang/SmartDNSDomainList)项目，并遵循[模板文件](https://github.com/eaglexiang/SmartDNSDomainList/raw/master/list.txt)中注释部分所述规则。

如果被解析的域名处于白名单中，则会使用服务端进行代理解析。如果没有，则会先在本地解析，然后判断其是否处于国内。如果不是处于国内，则重新使用代理进行解析。

这样做的好处是可以尽量使用国内服务最近的CDN。

### 流量智能转发

流量的智能转发则相对简单得多。每个数据包会根据目的IP所在地的不同而采用不同的转发策略。对于大陆IP，直接由客户端在本地进行转发。对于其它IP，则由服务端进行代理转发。